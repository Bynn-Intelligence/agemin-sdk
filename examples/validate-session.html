<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agemin SDK - Automatic Session Validation (RECOMMENDED)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      padding: 50px;
      max-width: 700px;
      width: 100%;
    }
    
    h1 {
      color: #333;
      margin-bottom: 15px;
      font-size: 32px;
    }
    
    .badge {
      display: inline-block;
      background: #28a745;
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    
    .description {
      color: #666;
      line-height: 1.8;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .code-section {
      background: #f8f9fa;
      border-left: 4px solid #f5576c;
      padding: 20px;
      margin: 30px 0;
      border-radius: 5px;
    }
    
    .code-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
    }
    
    .code {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      line-height: 1.6;
    }
    
    .comment {
      color: #6a9955;
    }
    
    .keyword {
      color: #569cd6;
    }
    
    .string {
      color: #ce9178;
    }
    
    .function {
      color: #dcdcaa;
    }
    
    .status-box {
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .status-box.loading {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      display: block;
    }
    
    .status-box.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    
    .status-box.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    
    .content-area {
      padding: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      text-align: center;
      display: none;
      margin-top: 30px;
    }
    
    .content-area.visible {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .content-area h2 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .content-area p {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .feature-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .feature-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }
    
    .feature-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }
    
    .feature-desc {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .log-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    
    .log-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: #333;
    }
    
    .logs {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .log-entry {
      margin-bottom: 5px;
      line-height: 1.4;
    }
    
    .log-time {
      color: #858585;
      margin-right: 8px;
    }
    
    .log-success {
      color: #4ec9b0;
    }
    
    .log-error {
      color: #f48771;
    }
    
    .log-info {
      color: #9cdcfe;
    }
    
    .btn {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: 600;
      margin-top: 20px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <span class="badge">Recommended Approach</span>
    <h1>Automatic Session Validation</h1>
    
    <p class="description">
      This example demonstrates the <strong>validateSession()</strong> method, which is the 
      <strong>recommended approach</strong> for age-gating your website. It automatically:
    </p>
    
    <div class="features">
      <div class="feature-card">
        <div class="feature-icon">üç™</div>
        <div class="feature-title">Checks for existing session</div>
        <div class="feature-desc">Looks for a valid age verification cookie</div>
      </div>
      <div class="feature-card">
        <div class="feature-icon">‚ú®</div>
        <div class="feature-title">Auto-launches verification</div>
        <div class="feature-desc">If no valid session exists, starts verification automatically</div>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üîí</div>
        <div class="feature-title">Validates JWT integrity</div>
        <div class="feature-desc">Checks signature, expiration, domain, and device fingerprint</div>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üöÄ</div>
        <div class="feature-title">Seamless experience</div>
        <div class="feature-desc">Users verify once, access persists across pages</div>
      </div>
    </div>
    
    <div class="code-section">
      <div class="code-title">Implementation Code</div>
      <div class="code">
        <span class="comment">// This runs automatically when page loads</span><br>
        <span class="keyword">const</span> agemin = <span class="keyword">new</span> <span class="function">Agemin</span>({<br>
        &nbsp;&nbsp;assetId: <span class="string">'ast_HfQNoqfkqJdT5m8akPNKaXYu'</span>,<br>
        &nbsp;&nbsp;referenceId: <span class="function">generateUniqueId</span>(), <span class="comment">// Unique per user</span><br>
        &nbsp;&nbsp;debug: <span class="keyword">true</span><br>
        });<br><br>
        
        <span class="comment">// Check session and launch verification if needed</span><br>
        <span class="keyword">const</span> result = <span class="keyword">await</span> agemin.<span class="function">validateSession</span>({<br>
        &nbsp;&nbsp;<span class="function">onAgePass</span>: (data) => {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// User verified and meets age requirement</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;showProtectedContent();<br>
        &nbsp;&nbsp;},<br>
        &nbsp;&nbsp;<span class="function">onAgeFail</span>: (data) => {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// User verified but doesn't meet age requirement</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;window.location.href = <span class="string">'/age-restricted'</span>;<br>
        &nbsp;&nbsp;},<br>
        &nbsp;&nbsp;<span class="function">onError</span>: (error) => {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Technical error - show fallback</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;showFallbackAgeGate();<br>
        &nbsp;&nbsp;}<br>
        });<br><br>
        
        <span class="keyword">if</span> (result === <span class="keyword">true</span>) {<br>
        &nbsp;&nbsp;<span class="comment">// User already has valid session from previous verification</span><br>
        &nbsp;&nbsp;console.log(<span class="string">'Already verified!'</span>);<br>
        }
      </div>
    </div>
    
    <div id="status" class="status-box loading">
      ‚è≥ Checking age verification status...
    </div>
    
    <div id="protected-content" class="content-area">
      <h2>üéâ Welcome to Protected Content!</h2>
      <p>You have successfully verified your age and can access this content.</p>
    </div>
    
    <button id="reset-btn" class="btn" style="display: none;" onclick="resetSession()">
      Reset Session (For Testing)
    </button>
    
    <div class="log-section">
      <div class="log-title">Console Logs</div>
      <div id="logs" class="logs">
        <div class="log-entry">
          <span class="log-time">[00:00:00]</span>
          <span class="log-info">Page loaded, initializing SDK...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Include the SDK -->
  <script src="../dist/agemin-sdk.umd.js"></script>
  
  <script>
    // Utility function to generate unique ID
    function generateUniqueId() {
      // In production, use your session ID or user ID
      return 'ref_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    // Logging utility
    function addLog(message, type = 'info') {
      const logsDiv = document.getElementById('logs');
      const now = new Date();
      const timestamp = `[${now.toTimeString().split(' ')[0]}]`;
      
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">${timestamp}</span>
        <span class="log-${type}">${message}</span>
      `;
      logsDiv.appendChild(entry);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    }
    
    // Show status message
    function setStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = 'status-box ' + type;
    }
    
    // Show protected content
    function showProtectedContent() {
      document.getElementById('protected-content').classList.add('visible');
      document.getElementById('reset-btn').style.display = 'inline-block';
    }
    
    // Reset session for testing
    function resetSession() {
      // Delete the verification cookie
      document.cookie = 'agemin_verification=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
      addLog('Session cookie deleted', 'info');
      location.reload();
    }
    
    // Show fallback age gate
    function showFallbackAgeGate() {
      if (confirm('Due to a technical issue, please confirm: Are you 18 years or older?')) {
        setStatus('‚úÖ Age confirmed via fallback', 'success');
        showProtectedContent();
        addLog('Age confirmed via fallback method', 'success');
      } else {
        setStatus('‚õî Access restricted', 'error');
        addLog('Access restricted - user under age', 'error');
      }
    }
    
    // Main initialization
    async function initializeAgeVerification() {
      addLog('Initializing Agemin SDK...', 'info');
      
      try {
        // Initialize SDK with unique reference ID
        const referenceId = generateUniqueId();
        addLog(`Generated reference ID: ${referenceId}`, 'info');
        
        const agemin = new Agemin({
          assetId: 'ast_HfQNoqfkqJdT5m8akPNKaXYu', // Replace with your Asset ID
          referenceId: referenceId,
          debug: true
        });
        
        addLog('SDK initialized successfully', 'success');
        addLog(`SDK Version: ${Agemin.version}`, 'info');
        
        setStatus('Validating age verification session...', 'loading');
        addLog('Calling validateSession()...', 'info');
        
        // THIS IS THE KEY METHOD - Automatically handles everything
        const result = await agemin.validateSession({
          onSuccess: (data) => {
            // Process completed (but doesn't indicate age result)
            addLog(`Verification process completed: ${JSON.stringify(data)}`, 'success');
          },
          
          onAgePass: (data) => {
            // User passed age verification
            addLog('‚úÖ USER PASSED AGE VERIFICATION', 'success');
            setStatus('‚úÖ Age verified - Welcome!', 'success');
            showProtectedContent();
          },
          
          onAgeFail: (data) => {
            // User failed age verification
            addLog('‚õî USER FAILED AGE VERIFICATION', 'error');
            setStatus('‚õî You do not meet the age requirement', 'error');
            
            // In production, redirect to age-appropriate content
            setTimeout(() => {
              addLog('Would redirect to /age-restricted in production', 'info');
              // window.location.href = '/age-restricted';
            }, 2000);
          },
          
          onError: (error) => {
            // Technical error occurred
            addLog(`Technical error: ${error.message}`, 'error');
            setStatus('‚ö†Ô∏è Technical issue - showing fallback', 'error');
            
            // Show fallback age confirmation
            setTimeout(showFallbackAgeGate, 1000);
          },
          
          onCancel: () => {
            addLog('User cancelled verification', 'info');
            setStatus('Verification cancelled', 'error');
          }
        });
        
        // Check immediate result
        if (result === true) {
          // User already had a valid session!
          addLog('üéØ User already verified from previous session!', 'success');
          setStatus('‚úÖ Already verified - Welcome back!', 'success');
          showProtectedContent();
        } else {
          addLog('No existing session, verification modal was launched', 'info');
        }
        
      } catch (error) {
        addLog(`Initialization error: ${error.message}`, 'error');
        setStatus('‚ö†Ô∏è Failed to initialize - showing fallback', 'error');
        showFallbackAgeGate();
      }
    }
    
    // Start when page loads
    window.addEventListener('load', () => {
      addLog('Page fully loaded', 'info');
      
      // Add info about browser support
      if (Agemin.isSupported()) {
        addLog('Browser is supported ‚úì', 'success');
      } else {
        addLog('Browser not supported ‚úó', 'error');
      }
      
      // Start the age verification process
      initializeAgeVerification();
    });
    
    // Log when page becomes visible (useful for debugging)
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        addLog('Page became visible', 'info');
      }
    });
  </script>
</body>
</html>